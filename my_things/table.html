

<style>

</style>

<!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->



<button>Play</button>


<!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->

<script>
 
    fetch("https://thepaciellogroup.github.io/AT-browser-tests/audio/jeffbob.mp3")
    // Retrieve its body as ReadableStream
    .then((response) => {

        const reader = response.body.getReader();

        return new ReadableStream({
            start: function(controller) {

                function pump() {
                    return reader.read().then(async({ done, value }) => {
                        // When no more data needs to be consumed, close the stream
                        if (done) {

                            return;
                        }
                        // Enqueue the next data chunk into our target stream
                        let b = await (await (new Response(value)) ).blob();
                        let audio = new Audio(await (URL.createObjectURL(b)));
                        document.querySelector("button").onclick = audio.play;
                        await new Promise((resolve, reject) => {
                            if(audio.paused)resolve();
                        })
                        controller.enqueue(value);
                        return pump();
                    });
                }

                return pump();
            }
        })
    })
    // Create a new response out of the stream
    .then((stream) => new Response(stream))
    // Create an object URL for the response
    .then((response) => response.blob())
    .then((blob) => URL.createObjectURL(blob))
    .then((url) => {
        console.log(url);
    })
    .catch(error=>{alert(error)})

</script>
